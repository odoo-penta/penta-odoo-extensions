<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>
        <!-- Herencia para añadir información en common_details_info_template -->
        <template id="common_details_info_template_extend" inherit_id="l10n_ec_edi.common_details_info_template">
            <xpath expr="//detalles/detalle" position="replace">
                <detalle t-foreach="lines.items()" t-as="line_items">
                    <t t-set="line" t-value="line_items[0]"/>
                    <t t-set="line_tax_details" t-value="line_items[1]['tax_details']"/>
                    <t t-set="product" t-value="line.product_id"/>
                    <t t-set="product_code" t-value="product and (product.barcode or product.default_code or 'N/A')[:25]"/>
                    <t t-set="line_edi_values" t-value="line._l10n_ec_prepare_edi_vals_to_export_USD()"/>
                    <codigoInterno t-if="is_cnote" t-out="product_code"/>
                    <codigoAdicional t-if="is_cnote" t-out="product.l10n_ec_auxiliary_code"/>
                    <codigoPrincipal t-if="is_invoice or is_liquidation" t-out="product_code"/>
                    <codigoAuxiliar t-if="is_invoice or is_liquidation" t-out="product.l10n_ec_auxiliary_code"/>

                    <descripcion t-out="clean_str(line.name or line.product_id and line.product_id.name or 'OTRO')"/>
                    <cantidad t-out="format_num_6(line.quantity)"/>
                    <precioUnitario t-out="format_num_6(line_edi_values['price_unit'])"/>
                    <descuento t-out="format_num_2(line_edi_values['price_discount'] + abs(line.balance) - line_items[1]['base_amount'])"/>
                    <precioTotalSinImpuesto t-out="format_num_2(abs(line_items[1]['base_amount']))"/>

                    <!-- Construimos una lista con todos los atributos del producto y los unimos con '|' -->
                    <t t-set="lista_atributos" t-value="[]"/>
                    <t t-set="valores_atributos" t-value="[]"/>
                    <t t-foreach="line.product_id.product_template_attribute_value_ids" t-as="attr">
                        <t t-set="lista_atributos" t-value="lista_atributos + ['%s:' % attr.attribute_id.name]"/>
                        <t t-set="valores_atributos" t-value="valores_atributos + ['%s' % attr.name]"/>
                    </t>
                    <detallesAdicionales>
                        <detAdicional t-att="{'nombre': ' CLASE: SUBCLASE:', 'valor': 'MOTO HERO'}" t-out=" "/>
                    </detallesAdicionales>

                    <impuestos t-if="line_tax_details">
                        <impuesto t-foreach="line_tax_details.values()" t-as="tax_data">
                            <t t-call="l10n_ec_edi.common_tax_lines_template">
                                <t t-set="tarifa_pre_base" t-value="True"/>
                            </t>
                        </impuesto>
                    </impuestos>
                </detalle>
            </xpath>
        </template>
    </data>
</odoo>