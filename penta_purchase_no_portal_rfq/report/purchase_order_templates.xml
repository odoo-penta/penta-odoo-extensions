<?xml version="1.0" encoding="UTF-8"?>
<odoo>

    <template id="report_purchaseorder_document_hide_prices_rfq" inherit_id="purchase.report_purchaseorder_document">

        <!-- Definir la variable de control -->
        <xpath expr="//table" position="before">
            <t t-set="display_price_and_taxes"
               t-value="o.state in ['purchase', 'done']"/>
        </xpath>

        <!-- Encabezados -->
        <xpath expr="//th[@name='th_price_unit']" position="replace">
            <th t-if="display_price_and_taxes"
                name="th_price_unit"
                class="text-end">
                <strong>Unit Price</strong>
            </th>
        </xpath>

        <xpath expr="//th[@name='th_discount']" position="replace">
            <th t-if="display_price_and_taxes"
                name="th_discount"
                class="text-end">
                <strong>Disc.</strong>
            </th>
        </xpath>

        <xpath expr="//th[@name='th_taxes']" position="replace">
            <th t-if="display_price_and_taxes"
                name="th_taxes"
                class="text-end">
                <strong>Taxes</strong>
            </th>
        </xpath>

        <xpath expr="//th[@name='th_subtotal']" position="replace">
            <th t-if="display_price_and_taxes"
                name="th_subtotal"
                class="text-end">
                <strong>Amount</strong>
            </th>
        </xpath>

        <!-- Líneas -->
        <xpath expr="//td[span[@t-field='line.price_unit']]" position="replace">
            <td t-if="display_price_and_taxes" class="text-end">
                <span t-field="line.price_unit"/>
            </td>
        </xpath>

        <xpath expr="//td[.//span[@t-field='line.discount']]" position="replace">
            <td t-if="display_price_and_taxes" class="text-end">
                <span t-field="line.discount"/>%
            </td>
        </xpath>

        <xpath expr="//td[span[contains(@t-out, 'tax')]]" position="replace">
            <td t-if="display_price_and_taxes" class="text-end">
                <span t-out="', '.join([(tax.invoice_label or tax.name) for tax in line.taxes_id])"/>
            </td>
        </xpath>

        <xpath expr="//td[span[@t-field='line.price_subtotal']]" position="replace">
            <td t-if="display_price_and_taxes" class="text-end">
                <span t-field="line.price_subtotal"
                      t-options='{"widget": "monetary", "display_currency": o.currency_id}'/>
            </td>
        </xpath>

        <!-- Subtotales por sección -->
        <xpath expr="//td[@id='subtotal']" position="replace">
            <td t-if="display_price_and_taxes" colspan="99" id="subtotal">
                <strong class="mr16">Subtotal</strong>
                <span
                    t-out="current_subtotal"
                    t-options='{"widget": "monetary", "display_currency": o.currency_id}'
                />
            </td>
        </xpath>

        <!-- Totales -->
        <xpath expr="//div[@id='total']" position="replace">
            <div t-if="display_price_and_taxes"
                 id="total"
                 class="row justify-content-end mt-n3">
                <div class="col-4">
                    <table class="o_total_table table table-borderless">
                        <t t-call="purchase.document_tax_totals">
                            <t t-set="tax_totals" t-value="o.tax_totals"/>
                            <t t-set="currency" t-value="o.currency_id"/>
                        </t>
                    </table>
                </div>
            </div>
        </xpath>

    </template>

</odoo>
